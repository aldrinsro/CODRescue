   {% if articles_retournes %}
                        {% for article_retourne in articles_retournes %}
                        <tr class="table-row article-retourne-row"
                            data-id="{{ article_retourne.id }}"
                            data-commande-id-yz="{{ article_retourne.commande.id_yz }}"
                            data-article-nom="{{ article_retourne.article.nom }}"
                            data-client="{{ article_retourne.commande.client.prenom }} {{ article_retourne.commande.client.nom }}"
                            data-statut="{{ article_retourne.statut_retour }}"
                            data-date-retour="{{ article_retourne.date_retour|date:'d/m/Y' }}">

                            <!-- Colonne Articles & Variantes -->
                            <td class="table-cell whitespace-nowrap">
                                <div class="bg-gray-50 p-2 rounded-lg border border-gray-200">
                                    <div class="text-sm font-medium text-gray-900 mb-1">{{ article_retourne.article.nom }}</div>
                                    {% if article_retourne.article.reference %}
                                    <div class="text-xs text-gray-500 mb-1">Réf: {{ article_retourne.article.reference }}</div>
                                    {% endif %}
                                    {% if article_retourne.variante %}
                                        <div class="border-t border-gray-200 pt-1 mt-1">
                                            <div class="flex flex-wrap gap-1">
                                                {% if article_retourne.variante.couleur %}
                                                <span class="inline-flex items-center px-1.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                                    <i class="fas fa-palette mr-1"></i>{{ article_retourne.variante.couleur.nom }}
                                                </span>
                                                {% endif %}
                                                {% if article_retourne.variante.pointure %}
                                                <span class="inline-flex items-center px-1.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                                    <i class="fas fa-ruler mr-1"></i>{{ article_retourne.variante.pointure.pointure }}
                                                </span>
                                                {% endif %}
                                                <span class="inline-flex items-center px-1.5 py-0.5 rounded-full text-xs font-medium bg-orange-100 text-orange-800">
                                                    <i class="fas fa-box mr-1"></i>{{ article_retourne.quantite_retournee }}x
                                                </span>
                                                
                                            </div>
                                        </div>
                                    {% else %}
                                        <div class="border-t border-gray-200 pt-1 mt-1">
                                            <span class="inline-flex items-center px-1.5 py-0.5 rounded-full text-xs font-medium bg-orange-100 text-orange-800">
                                                <i class="fas fa-box mr-1"></i>{{ article_retourne.quantite_retournee }}x
                                            </span>
                                        </div>
                                    {% endif %}
                                </div>
                            </td>

                            <!-- Colonne N° Commande -->
                            <td class="table-cell whitespace-nowrap">
                                <div class="text-sm font-medium text-gray-900">{{ article_retourne.commande.id_yz }}</div>
                                <div class="text-xs text-gray-500">{{ article_retourne.commande.num_cmd|default:"-" }}</div>
                            </td>

                            <!-- Colonne Client -->
                            <td class="table-cell whitespace-nowrap">
                                <div class="text-sm font-medium text-gray-900">{{ article_retourne.commande.client.prenom }} {{ article_retourne.commande.client.nom }}</div>
                                {% if article_retourne.commande.client.email %}
                                <div class="text-xs text-gray-500">{{ article_retourne.commande.client.email }}</div>
                                {% endif %}
                            </td>

                            <!-- Colonne Date de Retour -->
                            <td class="table-cell whitespace-nowrap">
                                <div class="text-sm text-gray-900">{{ article_retourne.date_retour|date:"d/m/Y" }}</div>
                                <div class="text-xs text-gray-500">{{ article_retourne.date_retour|date:"H:i" }}</div>
                            </td>

                            <!-- Colonne Raison -->
                            <td class="table-cell">
                                <div class="text-sm text-gray-900 max-w-xs truncate" title="{{ article_retourne.raison_retour }}">
                                    {{ article_retourne.raison_retour|default:"Non spécifiée" }}
                                </div>
                            </td>

                            <!-- Colonne Prix à la commande -->
                            <td class="table-cell whitespace-nowrap">
                                <div class="text-sm font-bold text-green-600">{{ article_retourne.prix_unitaire_origine|floatformat:2 }} DH</div>
                                <div class="text-xs text-gray-500">Qté: {{ article_retourne.quantite_retournee }}x</div>
                            </td>

                            <!-- Colonne statut de Retour -->
                            <td class="table-cell whitespace-nowrap">
                                {% if article_retourne.statut_retour == 'en_attente' %}
                                <span class="etat-badge en-attente bg-yellow-100 text-yellow-800 border-yellow-200">
                                    <i class="fas fa-clock mr-1"></i>
                                    En attente
                                </span>
                                {% elif article_retourne.statut_retour == 'reintegre_stock' %}
                                <span class="etat-badge reintegre bg-green-100 text-green-800 border-green-200">
                                    <i class="fas fa-check-circle mr-1"></i>
                                    Réintégré
                                </span>
                                {% elif article_retourne.statut_retour == 'defectueux' %}
                                <span class="etat-badge defectueux bg-red-100 text-red-800 border-red-200">
                                    <i class="fas fa-times-circle mr-1"></i>
                                    Défectueux
                                </span>
                                {% elif article_retourne.statut_retour == 'traite' %}
                                <span class="etat-badge traite bg-blue-100 text-blue-800 border-blue-200">
                                    <i class="fas fa-check mr-1"></i>
                                    Traité
                                </span>
                                {% else %}
                                <span class="etat-badge autre bg-gray-100 text-gray-800 border-gray-200">
                                    {{ article_retourne.get_statut_retour_display }}
                                </span>
                                {% endif %}
                            </td>

                            <!-- Etat de commande  -->
                            <td class="table-cell whitespace-nowrap">
                                {% with etat_actuel=article_retourne.commande.etat_actuel %}
                                    {% if etat_actuel %}
                                        <span class="etat-badge" style="
                                            
                                            {% if etat_actuel.enum_etat.libelle == 'Retournée' %}
                                                background: #fee2e2; color: #dc2626; border: 1px solid #fecaca;
                                            {% elif etat_actuel.enum_etat.libelle == 'Livrée Partiellement' %}
                                                background: #fef3c7; color: #d97706; border: 1px solid #fde68a;
                                            {% else %}
                                                background: #e0e7ff; color: #3730a3; border: 1px solid #c7d2fe;
                                            {% endif %}
                                        ">
                                           
                                            {% if etat_actuel.enum_etat.libelle == 'Retournée' %}
                                                <i class="fas fa-undo mr-1"></i>
                                            {% elif etat_actuel.enum_etat.libelle == 'Livrée Partiellement' %}
                                                <i class="fas fa-truck mr-1"></i>
                                            {% else %}
                                                <i class="fas fa-info-circle mr-1"></i>
                                            {% endif %}
                                            {{ etat_actuel.enum_etat.libelle }}
                                        </span>
                                        <div class="text-xs text-gray-500 mt-1">
                                            {{ etat_actuel.date_debut|date:"d/m/Y H:i" }}
                                        </div>
                                        {% if etat_actuel.operateur %}
                                        <div class="text-xs text-gray-400">
                                            Par: {{ etat_actuel.operateur.prenom }} {{ etat_actuel.operateur.nom }}
                                        </div>
                                        {% endif %}
                                    {% else %}
                                        <span class="etat-badge bg-gray-100 text-gray-600 border-gray-200">
                                            <i class="fas fa-question mr-1"></i>
                                            Aucun état
                                        </span>
                                    {% endif %}
                                {% endwith %}
                            </td>

                            <!-- Colonne Actions -->
                            <td class="table-cell whitespace-nowrap text-center">
                                <div class="flex justify-center space-x-1">
                                    {% if article_retourne.statut_retour == 'en_attente' %}
                                        {% if article_retourne.peut_etre_reintegre %}
                                        <button onclick="traiterArticle({{ article_retourne.id }}, 'reintegrer_stock')"
                                                class="text-green-600 hover:text-green-900 transition-colors p-1"
                                                title="Réintégrer en stock">
                                            <i class="fas fa-check-circle text-lg"></i>
                                        </button>
                                        {% endif %}
                                        <button onclick="traiterArticle({{ article_retourne.id }}, 'marquer_defectueux')"
                                                class="text-red-600 hover:text-red-900 transition-colors p-1"
                                                title="Marquer défectueux">
                                            <i class="fas fa-times-circle text-lg"></i>
                                        </button>
                                    {% else %}
                                        <span class="text-gray-400 text-sm">
                                            <i class="fas fa-lock mr-1"></i>Traité
                                        </span>
                                    {% endif %}
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    {% else %}
                        <tr>
                            <td colspan="11" class="table-cell whitespace-nowrap text-center">
                                <div class="empty-state">
                                    <div class="empty-state-icon">
                                        <i class="fas fa-truck"></i>
                                    </div>
                                    <h3 class="text-xl font-medium text-gray-800 mb-2">Aucun articles Retournées pour l'instant </h3>
                                    <p class="text-gray-600 mb-4">Toutes les commandes ont été livrées complètement ou ne sont pas encore livrées.</p>
                                </div>
                            </td>
                        </tr>
                    {% endif %}