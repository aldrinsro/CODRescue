<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documentation Workflow YZ-CMD - Syst√®me de Gestion de Commandes</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f8f9fa;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: white;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            padding: 40px 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            margin-bottom: 40px;
            border-radius: 10px;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .toc {
            background-color: #f8f9fa;
            padding: 20px;
            margin: 30px 0;
            border-radius: 8px;
            border-left: 5px solid #667eea;
        }
        
        .toc h2 {
            color: #667eea;
            margin-bottom: 15px;
        }
        
        .toc ul {
            list-style: none;
        }
        
        .toc li {
            margin: 8px 0;
        }
        
        .toc a {
            color: #333;
            text-decoration: none;
            padding: 5px 10px;
            border-radius: 4px;
            transition: all 0.3s;
        }
        
        .toc a:hover {
            background-color: #667eea;
            color: white;
        }
        
        .section {
            margin: 40px 0;
            page-break-inside: avoid;
        }
        
        .section h2 {
            color: #667eea;
            font-size: 1.8em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }
        
        .section h3 {
            color: #764ba2;
            font-size: 1.4em;
            margin: 25px 0 15px 0;
        }
        
        .section h4 {
            color: #555;
            font-size: 1.2em;
            margin: 20px 0 10px 0;
        }
        
        .workflow-box {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border-left: 5px solid #667eea;
            font-family: 'Courier New', monospace;
            white-space: pre-line;
        }
        
        .tech-specs {
            background-color: #e8f4fd;
            padding: 15px;
            margin: 15px 0;
            border-radius: 6px;
            border: 1px solid #b3d9ff;
        }
        
        .models-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background-color: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .models-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: bold;
        }
        
        .models-table td {
            padding: 10px 12px;
            border-bottom: 1px solid #eee;
        }
        
        .models-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        .interface-card {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .interface-card h4 {
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .features-list {
            columns: 2;
            column-gap: 30px;
            margin: 15px 0;
        }
        
        .features-list li {
            margin: 8px 0;
            break-inside: avoid;
        }
        
        .status-flow {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            margin: 20px 0;
        }
        
        .status-item {
            background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%);
            padding: 10px 15px;
            margin: 5px;
            border-radius: 20px;
            font-weight: bold;
            color: #2d3436;
            text-align: center;
            min-width: 150px;
        }
        
        .arrow {
            color: #667eea;
            font-size: 1.5em;
            margin: 0 10px;
        }
        
        .important-note {
            background: linear-gradient(135deg, #ff7675 0%, #fd79a8 100%);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            font-weight: bold;
        }
        
        .code-block {
            background-color: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            overflow-x: auto;
        }
        
        .footer {
            text-align: center;
            padding: 30px 0;
            color: #777;
            border-top: 2px solid #eee;
            margin-top: 50px;
        }
        
        @media print {
            .container {
                box-shadow: none;
                max-width: none;
            }
            
            .section {
                page-break-inside: avoid;
            }
            
            .workflow-box {
                page-break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üèóÔ∏è DOCUMENTATION WORKFLOW YZ-CMD</h1>
            <div class="subtitle">Syst√®me de Gestion de Commandes E-commerce</div>
            <div class="subtitle">Architecture BPMN & Sp√©cifications Techniques Compl√®tes</div>
        </div>

        <!-- Table des Mati√®res -->
        <div class="toc">
            <h2>üìã Table des Mati√®res</h2>
            <ul>
                <li><a href="#overview">1. Vue d'Ensemble du Syst√®me</a></li>
                <li><a href="#architecture">2. Architecture Technique</a></li>
                <li><a href="#authentication">3. Syst√®me d'Authentification</a></li>
                <li><a href="#synchronization">4. Synchronisation Externe</a></li>
                <li><a href="#workflow-main">5. Workflow Principal des Commandes</a></li>
                <li><a href="#stock-management">6. Gestion Articles et Stock</a></li>
                <li><a href="#operations">7. Syst√®me Op√©rations et Tracking</a></li>
                <li><a href="#upsells">8. Gestion Upsells Automatique</a></li>
                <li><a href="#analytics">9. Analytics et KPIs</a></li>
                <li><a href="#interfaces">10. Interfaces Utilisateur Sp√©cialis√©es</a></li>
                <li><a href="#security">11. S√©curit√© et Middleware</a></li>
                <li><a href="#models">12. Mod√®les de Donn√©es</a></li>
                <li><a href="#deployment">13. D√©ploiement et Configuration</a></li>
            </ul>
        </div>

        <!-- Section 1: Vue d'Ensemble -->
        <div class="section" id="overview">
            <h2>1. üéØ Vue d'Ensemble du Syst√®me</h2>
            
            <h3>Description G√©n√©rale</h3>
            <p>YZ-CMD est un syst√®me complet de gestion de commandes e-commerce d√©velopp√© en Django, sp√©cialement con√ßu pour les √©quipes op√©rationnelles au Maroc. Le syst√®me int√®gre des fonctionnalit√©s avanc√©es de synchronisation, de tra√ßabilit√© et d'automatisation pour optimiser le processus de vente du premier contact jusqu'√† la livraison.</p>

            <h3>Objectifs M√©tier</h3>
            <ul>
                <li><strong>Automatisation Maximum :</strong> R√©duction des t√¢ches manuelles r√©p√©titives</li>
                <li><strong>Tra√ßabilit√© Compl√®te :</strong> Suivi d√©taill√© de chaque action et √©tat</li>
                <li><strong>Interfaces Sp√©cialis√©es :</strong> Outils adapt√©s √† chaque r√¥le op√©rationnel</li>
                <li><strong>Synchronisation Temps R√©el :</strong> Int√©gration avec sources externes (Google Sheets)</li>
                <li><strong>Analytics Avanc√©es :</strong> KPIs de performance et tableaux de bord</li>
            </ul>

            <h3>Technologies Utilis√©es</h3>
            <div class="tech-specs">
                <ul>
                    <li><strong>Backend :</strong> Django 5.1.7 avec PostgreSQL/SQLite</li>
                    <li><strong>Frontend :</strong> HTML5, CSS3, JavaScript, TailwindCSS</li>
                    <li><strong>APIs :</strong> Django REST Framework, Google Sheets API</li>
                    <li><strong>Authentification :</strong> Django Auth avec groupes personnalis√©s</li>
                    <li><strong>Monitoring :</strong> Logging int√©gr√© avec middleware personnalis√©</li>
                    <li><strong>S√©curit√© :</strong> CSRF Protection, Session Management, CORS</li>
                </ul>
            </div>
        </div>

        <!-- Section 2: Architecture -->
        <div class="section" id="architecture">
            <h2>2. üèõÔ∏è Architecture Technique</h2>
            
            <h3>Structure Modulaire</h3>
            <p>Le syst√®me est organis√© en applications Django sp√©cialis√©es :</p>

            <div class="interface-card">
                <h4>üì¶ Applications Core</h4>
                <ul>
                    <li><strong>config :</strong> Configuration principale et middleware</li>
                    <li><strong>parametre :</strong> Gestion utilisateurs, r√©gions, villes</li>
                    <li><strong>client :</strong> Gestion base clients</li>
                    <li><strong>article :</strong> Catalogue produits et stock</li>
                    <li><strong>commande :</strong> Workflow principal des commandes</li>
                </ul>
            </div>

            <div class="interface-card">
                <h4>‚öôÔ∏è Applications M√©tier</h4>
                <ul>
                    <li><strong>operatConfirme :</strong> Interface op√©rateurs confirmation</li>
                    <li><strong>operatLogistic :</strong> Interface op√©rateurs logistique</li>
                    <li><strong>Prepacommande :</strong> Interface pr√©paration/impression</li>
                    <li><strong>synchronisation :</strong> Int√©gration Google Sheets</li>
                    <li><strong>kpis :</strong> Analytics et tableaux de bord</li>
                </ul>
            </div>

            <h3>Pattern MVT (Model-View-Template)</h3>
            <div class="workflow-box">
Models (Donn√©es) ‚Üî Views (Logique M√©tier) ‚Üî Templates (Interface)
                ‚Üï
    Middleware (S√©curit√©/Session/Validation)
                ‚Üï
        APIs Externes (Google Sheets)
            </div>
        </div>

        <!-- Section 3: Authentification -->
        <div class="section" id="authentication">
            <h2>3. üîê Syst√®me d'Authentification</h2>
            
            <h3>Workflow d'Authentification</h3>
            <div class="workflow-box">
Connexion Utilisateur
    ‚Üì
Validation Credentials (Django Auth)
    ‚Üì
V√©rification Profil Op√©rateur (type_operateur)
    ‚Üì
    TYPES DISPONIBLES :
    ‚îú‚îÄ‚îÄ ADMIN ‚Üí Interface Administrateur
    ‚îú‚îÄ‚îÄ CONFIRMATION ‚Üí Interface Confirmation
    ‚îú‚îÄ‚îÄ LOGISTIQUE ‚Üí Interface Logistique
    ‚îî‚îÄ‚îÄ PREPARATION ‚Üí Interface Pr√©paration
    ‚Üì
Redirection Automatique + Gestion Session
    ‚Üì
Middleware de Validation Continue
            </div>

            <h3>S√©curit√© Avanc√©e</h3>
            <div class="tech-specs">
                <h4>üõ°Ô∏è Protections Impl√©ment√©es</h4>
                <ul>
                    <li><strong>Session Timeout :</strong> D√©connexion automatique apr√®s inactivit√© (2h)</li>
                    <li><strong>CSRF Protection :</strong> Protection contre les attaques cross-site</li>
                    <li><strong>Validation Type Utilisateur :</strong> Contr√¥le d'acc√®s par interface</li>
                    <li><strong>Logging S√©curis√© :</strong> Tra√ßabilit√© des connexions/actions</li>
                </ul>
            </div>

            <div class="code-block">
# Middleware de validation utilisateur
class UserTypeValidationMiddleware:
    allowed_prefixes = {
        'ADMIN': '/parametre/',
        'CONFIRMATION': '/operateur-confirme/',
        'LOGISTIQUE': '/operateur-logistique/', 
        'PREPARATION': '/operateur-preparation/'
    }
            </div>
        </div>

        <!-- Section 4: Synchronisation -->
        <div class="section" id="synchronization">
            <h2>4. üîÑ Synchronisation Externe</h2>
            
            <h3>Int√©gration Google Sheets</h3>
            <div class="workflow-box">
Google Sheets (Source Externe)
    ‚Üì
API Authentication (Service Account)
    ‚Üì
Lecture Structure : Headers + Data Rows
    ‚Üì
Traitement Ligne par Ligne :
    ‚îú‚îÄ‚îÄ Parsing Donn√©es Client (T√©l√©phone/Nom/Adresse)
    ‚îú‚îÄ‚îÄ Parsing Produit (Nom/Couleur/Taille/Prix)
    ‚îú‚îÄ‚îÄ Mapping Statut ‚Üí √âtats Syst√®me
    ‚îî‚îÄ‚îÄ Validation Op√©rateur
    ‚Üì
Logique Anti-Doublons :
    ‚îú‚îÄ‚îÄ [NOUVEAU] ‚Üí Cr√©ation Commande + Client + Article
    ‚îú‚îÄ‚îÄ [EXISTANT] ‚Üí Mise √† Jour si Changements
    ‚îî‚îÄ‚îÄ [DOUBLON] ‚Üí Skip avec Log
    ‚Üì
Cr√©ation √âtats Automatique + Logs D√©taill√©s
            </div>

            <h3>Statistiques de Synchronisation</h3>
            <table class="models-table">
                <thead>
                    <tr>
                        <th>M√©trique</th>
                        <th>Description</th>
                        <th>Utilit√©</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>new_orders_created</td>
                        <td>Nouvelles commandes cr√©√©es</td>
                        <td>Croissance volume</td>
                    </tr>
                    <tr>
                        <td>existing_orders_updated</td>
                        <td>Commandes existantes mises √† jour</td>
                        <td>Suivi modifications</td>
                    </tr>
                    <tr>
                        <td>duplicate_orders_found</td>
                        <td>Doublons d√©tect√©s</td>
                        <td>Qualit√© donn√©es</td>
                    </tr>
                    <tr>
                        <td>execution_details</td>
                        <td>D√©tails JSON complets</td>
                        <td>Debug/Audit</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Section 5: Workflow Principal -->
        <div class="section" id="workflow-main">
            <h2>5. üéØ Workflow Principal des Commandes</h2>
            
            <h3>Phase 1 : Affectation et Confirmation</h3>
            <div class="status-flow">
                <div class="status-item">Non Affect√©e</div>
                <span class="arrow">‚Üí</span>
                <div class="status-item">Affect√©e</div>
                <span class="arrow">‚Üí</span>
                <div class="status-item">En Cours Confirmation</div>
                <span class="arrow">‚Üí</span>
                <div class="status-item">Confirm√©e</div>
            </div>

            <div class="workflow-box">
PROCESSUS CONFIRMATION D√âTAILL√â :

1. Affectation Op√©rateur Confirmation
   ‚îú‚îÄ‚îÄ Manuelle (Admin)
   ‚îî‚îÄ‚îÄ Automatique (Round-Robin)

2. Interface Op√©rateur Confirmation
   ‚îú‚îÄ‚îÄ Appel T√©l√©phone Standard
   ‚îú‚îÄ‚îÄ WhatsApp (Appel/Message/Vocal)
   ‚îî‚îÄ‚îÄ SMS

3. Validation Donn√©es
   ‚îú‚îÄ‚îÄ Informations Client (Nom/Tel/Adresse)
   ‚îú‚îÄ‚îÄ D√©tails Produit (Disponibilit√©)
   ‚îî‚îÄ‚îÄ Informations Livraison (Ville/Frais)

4. Enregistrement Op√©ration
   ‚îú‚îÄ‚îÄ Type Communication
   ‚îú‚îÄ‚îÄ Conclusion Libre
   ‚îú‚îÄ‚îÄ Commentaire Pr√©d√©fini
   ‚îî‚îÄ‚îÄ Horodatage Automatique

5. D√©cision Finale
   ‚îú‚îÄ‚îÄ [CONFIRM√âE] ‚Üí D√©cr√©mentation Stock + Transition
   ‚îú‚îÄ‚îÄ [ERRON√âE] ‚Üí Archivage + Motif
   ‚îú‚îÄ‚îÄ [DOUBLON] ‚Üí Suppression + Log
   ‚îî‚îÄ‚îÄ [ANNUL√âE] ‚Üí √âtat Final + Motif
            </div>

            <h3>Phase 2 : Pr√©paration</h3>
            <div class="status-flow">
                <div class="status-item">Confirm√©e</div>
                <span class="arrow">‚Üí</span>
                <div class="status-item">√Ä Imprimer</div>
                <span class="arrow">‚Üí</span>
                <div class="status-item">En Pr√©paration</div>
                <span class="arrow">‚Üí</span>
                <div class="status-item">Pr√©par√©e</div>
            </div>

            <div class="workflow-box">
PROCESSUS PR√âPARATION D√âTAILL√â :

1. Affectation Automatique Op√©rateur Pr√©paration
   ‚îî‚îÄ‚îÄ Transition √âtat "√Ä Imprimer"

2. Impression Documents
   ‚îú‚îÄ‚îÄ √âtiquettes Exp√©dition (Adresse/Client)
   ‚îú‚îÄ‚îÄ Tickets Pr√©paration (Articles/Quantit√©s)
   ‚îî‚îÄ‚îÄ Bons de Commande (R√©capitulatif)

3. Pr√©paration Physique
   ‚îú‚îÄ‚îÄ Validation √âtat "En Pr√©paration"
   ‚îú‚îÄ‚îÄ Collecte Articles selon Ticket
   ‚îú‚îÄ‚îÄ V√©rification Qualit√©/Quantit√©
   ‚îî‚îÄ‚îÄ Emballage Final

4. Validation Pr√©paration
   ‚îú‚îÄ‚îÄ Contr√¥le Final Op√©rateur
   ‚îú‚îÄ‚îÄ Transition √âtat "Pr√©par√©e"
   ‚îî‚îÄ‚îÄ D√©clenchement Automatique R√©partition Livraison
            </div>

            <h3>Phase 3 : Livraison</h3>
            <div class="status-flow">
                <div class="status-item">Pr√©par√©e</div>
                <span class="arrow">‚Üí</span>
                <div class="status-item">En Cours Livraison</div>
                <span class="arrow">‚Üí</span>
                <div class="status-item">Livr√©e</div>
            </div>

            <div class="important-note">
                üöÄ AUTOMATISATION CL√â : La r√©partition automatique des commandes pr√©par√©es vers les op√©rateurs logistiques utilise un algorithme Round-Robin pour √©quilibrer la charge de travail.
            </div>
        </div>

        <!-- Section 6: Gestion Stock -->
        <div class="section" id="stock-management">
            <h2>6. üì¶ Gestion Articles et Stock</h2>
            
            <h3>Mod√®le Article Avanc√©</h3>
            <table class="models-table">
                <thead>
                    <tr>
                        <th>Champ</th>
                        <th>Type</th>
                        <th>Description</th>
                        <th>Utilisation</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>nom, couleur, pointure</td>
                        <td>Cl√© Unique</td>
                        <td>Identification article</td>
                        <td>Contrainte unicit√©</td>
                    </tr>
                    <tr>
                        <td>prix_unitaire</td>
                        <td>Decimal</td>
                        <td>Prix de base</td>
                        <td>Calculs standards</td>
                    </tr>
                    <tr>
                        <td>prix_upsell_1-4</td>
                        <td>Decimal</td>
                        <td>Prix par quantit√©</td>
                        <td>Logique upsells</td>
                    </tr>
                    <tr>
                        <td>qte_disponible</td>
                        <td>Integer</td>
                        <td>Stock temps r√©el</td>
                        <td>Gestion automatique</td>
                    </tr>
                    <tr>
                        <td>phase</td>
                        <td>Choice</td>
                        <td>EN_COURS/LIQUIDATION/EN_TEST</td>
                        <td>Strat√©gie commerciale</td>
                    </tr>
                </tbody>
            </table>

            <h3>Syst√®me de Mouvements Stock</h3>
            <div class="workflow-box">
TYPES MOUVEMENTS AUTOMATIQUES :

‚îú‚îÄ‚îÄ ENTR√âE
‚îÇ   ‚îú‚îÄ‚îÄ R√©approvisionnement Manuel
‚îÇ   ‚îú‚îÄ‚îÄ Retour Client (Annulation)
‚îÇ   ‚îî‚îÄ‚îÄ Ajustement Inventaire (+)

‚îú‚îÄ‚îÄ SORTIE  
‚îÇ   ‚îú‚îÄ‚îÄ Confirmation Commande (Automatique)
‚îÇ   ‚îú‚îÄ‚îÄ Perte/Casse
‚îÇ   ‚îî‚îÄ‚îÄ Ajustement Inventaire (-)

‚îî‚îÄ‚îÄ TRA√áABILIT√â
    ‚îú‚îÄ‚îÄ Op√©rateur Responsable
    ‚îú‚îÄ‚îÄ Commande Associ√©e (si applicable)
    ‚îú‚îÄ‚îÄ Commentaire Justificatif
    ‚îî‚îÄ‚îÄ Horodatage Pr√©cis
            </div>

            <h3>Alertes Stock Intelligent</h3>
            <div class="tech-specs">
                <ul>
                    <li><strong>Stock Faible :</strong> Alerte < 5 unit√©s (param√©trable)</li>
                    <li><strong>Rupture Stock :</strong> Alerte = 0 unit√©s</li>
                    <li><strong>Validation Confirmation :</strong> V√©rification stock avant validation</li>
                    <li><strong>R√©servation Temporaire :</strong> Stock "gel√©" pendant confirmation</li>
                </ul>
            </div>
        </div>

        <!-- Section 7: Op√©rations -->
        <div class="section" id="operations">
            <h2>7. ‚öôÔ∏è Syst√®me Op√©rations et Tracking</h2>
            
            <h3>Types d'Op√©rations Support√©es</h3>
            <div class="interface-card">
                <h4>üìû Communications Client</h4>
                <ul>
                    <li><strong>Appel T√©l√©phone :</strong> Communication standard</li>
                    <li><strong>WhatsApp Appel :</strong> Appel via WhatsApp</li>
                    <li><strong>WhatsApp Message :</strong> Message texte WhatsApp</li>
                    <li><strong>WhatsApp Vocal :</strong> Message vocal WhatsApp</li>
                    <li><strong>SMS :</strong> Message texte court</li>
                </ul>
            </div>

            <div class="interface-card">
                <h4>üîß Op√©rations Techniques</h4>
                <ul>
                    <li><strong>Modification :</strong> Changement donn√©es commande</li>
                    <li><strong>Probl√®me Signal√© :</strong> Issue technique/logistique</li>
                    <li><strong>Renvoi Pr√©paration :</strong> Retour en pr√©paration</li>
                </ul>
            </div>

            <h3>Commentaires Pr√©d√©finis</h3>
            <div class="workflow-box">
COMMENTAIRES STANDARDIS√âS :

‚îú‚îÄ‚îÄ √âtats Client
‚îÇ   ‚îú‚îÄ‚îÄ "Client h√©sitant"
‚îÇ   ‚îú‚îÄ‚îÄ "Client int√©ress√©" 
‚îÇ   ‚îú‚îÄ‚îÄ "Client non int√©ress√©"
‚îÇ   ‚îî‚îÄ‚îÄ "Client non joignable"

‚îú‚îÄ‚îÄ Statuts Commande
‚îÇ   ‚îú‚îÄ‚îÄ "Commande Annul√©e"
‚îÇ   ‚îú‚îÄ‚îÄ "Commande report√©e"
‚îÇ   ‚îî‚îÄ‚îÄ "Article non disponible"

‚îî‚îÄ‚îÄ Suivi Automatique
    ‚îú‚îÄ‚îÄ Horodatage Pr√©cis
    ‚îú‚îÄ‚îÄ Op√©rateur Responsable
    ‚îî‚îÄ‚îÄ Historique Complet Consultable
            </div>
        </div>

        <!-- Section 8: Upsells -->
        <div class="section" id="upsells">
            <h2>8. üí∞ Gestion Upsells Automatique</h2>
            
            <h3>Logique de Calcul Automatique</h3>
            <div class="workflow-box">
SYST√àME COMPTEUR UPSELL :

Article marqu√© isUpsell = True
    ‚Üì
Compteur Commande (initialis√© √† 0)
    ‚Üì
    AJOUT/MODIFICATION ARTICLES :
    ‚îú‚îÄ‚îÄ 1 Article ‚Üí Prix Standard (compteur +0)
    ‚îú‚îÄ‚îÄ 2 Articles ‚Üí Prix Upsell 1 (compteur +1)  
    ‚îú‚îÄ‚îÄ 3 Articles ‚Üí Prix Upsell 2 (compteur +2)
    ‚îî‚îÄ‚îÄ 4+ Articles ‚Üí Prix Upsell 3/4 (compteur +3/4)
    ‚Üì
Recalcul Automatique Total Commande
    ‚îú‚îÄ‚îÄ Nouveau Prix √ó Quantit√©
    ‚îú‚îÄ‚îÄ + Frais Livraison (selon ville)
    ‚îî‚îÄ‚îÄ Sauvegarde Transparente
            </div>

            <h3>Exemple Concret de Calcul</h3>
            <table class="models-table">
                <thead>
                    <tr>
                        <th>Quantit√©</th>
                        <th>Prix Unitaire</th>
                        <th>Compteur</th>
                        <th>Total Articles</th>
                        <th>+ Frais Livraison</th>
                        <th>Total Final</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>1</td>
                        <td>299 MAD</td>
                        <td>0</td>
                        <td>299 MAD</td>
                        <td>25 MAD</td>
                        <td>324 MAD</td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td>249 MAD</td>
                        <td>1</td>
                        <td>498 MAD</td>
                        <td>25 MAD</td>
                        <td>523 MAD</td>
                    </tr>
                    <tr>
                        <td>3</td>
                        <td>219 MAD</td>
                        <td>2</td>
                        <td>657 MAD</td>
                        <td>25 MAD</td>
                        <td>682 MAD</td>
                    </tr>
                    <tr>
                        <td>4+</td>
                        <td>199 MAD</td>
                        <td>3/4</td>
                        <td>796+ MAD</td>
                        <td>25 MAD</td>
                        <td>821+ MAD</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Section 9: Analytics -->
        <div class="section" id="analytics">
            <h2>9. üìà Analytics et KPIs</h2>
            
            <h3>Dashboard 360¬∞ - M√©triques Cl√©s</h3>
            <div class="features-list">
                <li><strong>Performance Op√©rateurs :</strong> Temps traitement moyen, taux conversion</li>
                <li><strong>√âvolution CA :</strong> Chiffre d'affaires par p√©riode</li>
                <li><strong>Top Mod√®les :</strong> Articles les plus vendus</li>
                <li><strong>Performance R√©gions :</strong> Ventes par zone g√©ographique</li>
                <li><strong>Statistiques Clients :</strong> Acquisition, fid√©lisation</li>
                <li><strong>Vue Quantitative :</strong> Volumes, stocks, mouvements</li>
                <li><strong>Taux Livraison :</strong> Success rate livraisons</li>
                <li><strong>Analyse Temporelle :</strong> Patterns temporels</li>
            </div>

            <h3>KPIs Temps R√©el</h3>
            <div class="workflow-box">
CALCULS AUTOMATIQUES :

‚îú‚îÄ‚îÄ Performance Op√©rateurs
‚îÇ   ‚îú‚îÄ‚îÄ Temps Moyen par Commande
‚îÇ   ‚îú‚îÄ‚îÄ Nombre Commandes Trait√©es/Jour
‚îÇ   ‚îú‚îÄ‚îÄ Taux de Conversion (Confirm√©e/Affect√©e)
‚îÇ   ‚îî‚îÄ‚îÄ Distribution Temps de Traitement

‚îú‚îÄ‚îÄ M√©triques Business
‚îÇ   ‚îú‚îÄ‚îÄ CA Total/P√©riode (Jour/Semaine/Mois)
‚îÇ   ‚îú‚îÄ‚îÄ Panier Moyen Client
‚îÇ   ‚îú‚îÄ‚îÄ Taux Retour/Annulation
‚îÇ   ‚îî‚îÄ‚îÄ Progression Objectifs

‚îî‚îÄ‚îÄ Analyse Op√©rationnelle
    ‚îú‚îÄ‚îÄ Stock Moyen par Article
    ‚îú‚îÄ‚îÄ Rotation Stock (Velocity)
    ‚îú‚îÄ‚îÄ Temps Cycle Commande Compl√®te
    ‚îî‚îÄ‚îÄ Goulots d'√âtranglement Identifi√©s
            </div>

            <h3>Exports et Rapports</h3>
            <div class="tech-specs">
                <ul>
                    <li><strong>Export Excel :</strong> Donn√©es d√©taill√©es performance op√©rateurs</li>
                    <li><strong>Export CSV :</strong> Donn√©es brutes pour analyses externes</li>
                    <li><strong>Rapports Automatiques :</strong> Synth√®ses quotidiennes/hebdomadaires</li>
                    <li><strong>API REST :</strong> Int√©gration syst√®mes tiers</li>
                </ul>
            </div>
        </div>

        <!-- Section 10: Interfaces -->
        <div class="section" id="interfaces">
            <h2>10. üíª Interfaces Utilisateur Sp√©cialis√©es</h2>
            
            <h3>Interface Administrateur</h3>
            <div class="interface-card">
                <h4>üîß Fonctionnalit√©s Admin</h4>
                <ul>
                    <li>Gestion globale utilisateurs et op√©rateurs</li>
                    <li>Configuration synchronisation Google Sheets</li>
                    <li>Monitoring syst√®me et logs</li>
                    <li>Param√©trage r√©gions/villes/frais livraison</li>
                    <li>Dashboard KPIs 360¬∞</li>
                    <li>Gestion articles, stock et promotions</li>
                    <li>Diagnostic et correction donn√©es</li>
                </ul>
            </div>

            <h3>Interface Op√©rateur Confirmation</h3>
            <div class="interface-card">
                <h4>üìû Outils Confirmation</h4>
                <ul>
                    <li>Liste commandes affect√©es (temps r√©el)</li>
                    <li>Interface appels optimis√©e (Tel/WhatsApp/SMS)</li>
                    <li>Commentaires pr√©d√©finis rapides</li>
                    <li>Validation informations client/livraison</li>
                    <li>Gestion stock en temps r√©el</li>
                    <li>Historique op√©rations personnelles</li>
                    <li>Statistiques performance individuelles</li>
                </ul>
            </div>

            <h3>Interface Op√©rateur Logistique</h3>
            <div class="interface-card">
                <h4>üöö Gestion Livraisons</h4>
                <ul>
                    <li>Vue commandes pr√©par√©es par r√©gion</li>
                    <li>Cr√©ation et gestion envois</li>
                    <li>Planification tourn√©es livraison</li>
                    <li>Gestion probl√®mes/reports/retours</li>
                    <li>Service apr√®s-vente int√©gr√©</li>
                    <li>Suivi temps r√©el livraisons</li>
                    <li>Interface mobile-friendly</li>
                </ul>
            </div>

            <h3>Interface Op√©rateur Pr√©paration</h3>
            <div class="interface-card">
                <h4>üì¶ Pr√©paration & Impression</h4>
                <ul>
                    <li>File d'attente commandes √† traiter</li>
                    <li>Impression √©tiquettes/tickets optimis√©e</li>
                    <li>Interface pr√©paration guid√©e</li>
                    <li>Contr√¥le qualit√© int√©gr√©</li>
                    <li>Gestion modifications derni√®re minute</li>
                    <li>Statistiques productivit√©</li>
                    <li>Alertes stock insuffisant</li>
                </ul>
            </div>
        </div>

        <!-- Section 11: S√©curit√© -->
        <div class="section" id="security">
            <h2>11. üõ°Ô∏è S√©curit√© et Middleware</h2>
            
            <h3>Stack S√©curit√© Compl√®te</h3>
            <div class="workflow-box">
COUCHES PROTECTION :

1. Middleware Django Standard
   ‚îú‚îÄ‚îÄ SecurityMiddleware (HTTPS, Headers)
   ‚îú‚îÄ‚îÄ SessionMiddleware (Gestion sessions)
   ‚îú‚îÄ‚îÄ CsrfViewMiddleware (Protection CSRF)
   ‚îî‚îÄ‚îÄ AuthenticationMiddleware (Auth users)

2. Middleware Personnalis√© YZ-CMD
   ‚îú‚îÄ‚îÄ SessionTimeoutMiddleware (Timeout auto)
   ‚îú‚îÄ‚îÄ UserTypeValidationMiddleware (Contr√¥le acc√®s)
   ‚îî‚îÄ‚îÄ CSRFDebugMiddleware (Debug CSRF dev)

3. Contr√¥les Applicatifs
   ‚îú‚îÄ‚îÄ Validation type utilisateur par route
   ‚îú‚îÄ‚îÄ V√©rification permissions par action
   ‚îú‚îÄ‚îÄ Logging s√©curis√© toutes actions
   ‚îî‚îÄ‚îÄ Audit trail complet
            </div>

            <h3>Gestion Sessions Avanc√©e</h3>
            <div class="tech-specs">
                <h4>üîê Configuration Sessions</h4>
                <ul>
                    <li><strong>Dur√©e :</strong> 24h avec refresh automatique</li>
                    <li><strong>Timeout Inactivit√© :</strong> 2h d√©connexion auto</li>
                    <li><strong>Cookie S√©curis√© :</strong> HttpOnly + Secure en prod</li>
                    <li><strong>Nom Personnalis√© :</strong> yz_cmd_sessionid</li>
                    <li><strong>Nettoyage Auto :</strong> Cleanup sessions expir√©es</li>
                </ul>
            </div>

            <h3>Protection CSRF Renforc√©e</h3>
            <div class="code-block">
# Configuration CSRF personnalis√©e
CSRF_COOKIE_NAME = 'yz_csrf_token'
CSRF_COOKIE_AGE = 31449600  # 1 an
CSRF_TRUSTED_ORIGINS = [
    'http://localhost:8000',
    'http://192.168.*:8000',  # R√©seau local
]
            </div>
        </div>

        <!-- Section 12: Mod√®les -->
        <div class="section" id="models">
            <h2>12. üóÉÔ∏è Mod√®les de Donn√©es</h2>
            
            <h3>Relations Principales</h3>
            <div class="workflow-box">
SCH√âMA RELATIONNEL :

User (Django) ‚Üê‚Üí Operateur (1:1)
                     ‚Üì
Client ‚Üí Commande ‚Üê Ville ‚Üê Region  
   ‚Üì        ‚Üì        ‚Üì
   ‚îî‚Üí Panier ‚Üí Article
            ‚Üì
      EtatCommande ‚Üê EnumEtatCmd
            ‚Üì           ‚Üë
        Operation ‚Üí Operateur
            ‚Üì
      MouvementStock
            </div>

            <h3>Mod√®les Critiques</h3>
            <table class="models-table">
                <thead>
                    <tr>
                        <th>Mod√®le</th>
                        <th>Responsabilit√©</th>
                        <th>Relations Cl√©s</th>
                        <th>Contraintes</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Commande</td>
                        <td>Entit√© centrale workflow</td>
                        <td>Client, Ville, Panier, √âtats</td>
                        <td>num_cmd unique, total ‚â• 0</td>
                    </tr>
                    <tr>
                        <td>EtatCommande</td>
                        <td>Historique transitions</td>
                        <td>Commande, EnumEtatCmd, Operateur</td>
                        <td>date_debut ‚â§ date_fin</td>
                    </tr>
                    <tr>
                        <td>Article</td>
                        <td>Catalogue + Stock</td>
                        <td>Panier, MouvementStock</td>
                        <td>(nom,couleur,pointure) unique</td>
                    </tr>
                    <tr>
                        <td>Operation</td>
                        <td>Tra√ßabilit√© actions</td>
                        <td>Commande, Operateur</td>
                        <td>Horodatage automatique</td>
                    </tr>
                </tbody>
            </table>

            <h3>Contraintes d'Int√©grit√©</h3>
            <div class="tech-specs">
                <ul>
                    <li><strong>Unicit√© :</strong> Region.nom_region, Client.numero_tel, Article(nom+couleur+pointure)</li>
                    <li><strong>Valeurs Positives :</strong> Article.prix_unitaire > 0, qte_disponible ‚â• 0</li>
                    <li><strong>Coh√©rence Temporelle :</strong> EtatCommande dates coh√©rentes</li>
                    <li><strong>Int√©grit√© R√©f√©rentielle :</strong> CASCADE/SET_NULL selon logique m√©tier</li>
                </ul>
            </div>
        </div>

        <!-- Section 13: D√©ploiement -->
        <div class="section" id="deployment">
            <h2>13. üöÄ D√©ploiement et Configuration</h2>
            
            <h3>Pr√©requis Syst√®me</h3>
            <div class="tech-specs">
                <h4>üîß Stack Technique</h4>
                <ul>
                    <li><strong>Python :</strong> 3.9+ avec pip</li>
                    <li><strong>Django :</strong> 5.1.7 avec dependencies</li>
                    <li><strong>Base de Donn√©es :</strong> PostgreSQL 12+ (ou SQLite dev)</li>
                    <li><strong>Node.js :</strong> 16+ pour TailwindCSS</li>
                    <li><strong>Google API :</strong> Service Account configur√©</li>
                </ul>
            </div>

            <h3>Configuration Environnement</h3>
            <div class="code-block">
# Variables d'environnement requises
DB_NAME=yzcmd_db
DB_USER=postgres
DB_PASSWORD=your_password
DB_HOST=localhost
DB_PORT=5432
GOOGLE_SHEET_URL=https://docs.google.com/spreadsheets/...
SECRET_KEY=your-secret-key
DEBUG=False
            </div>

            <h3>Commandes de D√©ploiement</h3>
            <div class="workflow-box">
S√âQUENCE D√âPLOIEMENT :

1. Installation Dependencies
   pip install -r requirements.txt

2. Configuration Base de Donn√©es  
   python manage.py makemigrations
   python manage.py migrate

3. Cr√©ation Superutilisateur
   python manage.py createsuperuser

4. G√©n√©ration Op√©rateurs Test
   python generate_operators.py

5. Import Donn√©es Initiales
   python import_regions_villes.py
   python import_articles.py

6. Lancement Serveur
   python manage.py runserver 0.0.0.0:8000
            </div>

            <h3>Fichiers Configuration Critiques</h3>
            <ul>
                <li><strong>credentials.json :</strong> Service Account Google API</li>
                <li><strong>requirements.txt :</strong> Dependencies Python compl√®tes</li>
                <li><strong>settings.py :</strong> Configuration Django personnalis√©e</li>
                <li><strong>.env :</strong> Variables environnement sensibles</li>
            </ul>

            <div class="important-note">
                üî• ATTENTION : Assurez-vous que credentials.json est configur√© avec les bonnes permissions Google Sheets API et que les URLs CORS sont correctement d√©finies pour votre environnement de production.
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p><strong>YZ-CMD</strong> - Syst√®me de Gestion de Commandes E-commerce</p>
            <p>Documentation technique compl√®te - Version 1.0</p>
            <p>G√©n√©r√© le : <script>document.write(new Date().toLocaleDateString('fr-FR'));</script></p>
        </div>
    </div>
</body>
</html> 